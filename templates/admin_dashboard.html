<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - Chez Mich-Mich</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='michmich.css') }}">
    <style>
        .admin-container {
            max-width: 1400px;
            margin: 100px auto 50px;
            padding: 20px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: rgba(114, 189, 180, 0.2);
            padding: 20px;
            border-radius: 15px;
        }
        
        .admin-nav {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .admin-nav a {
            background: #72bdb4;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .admin-nav a:hover {
            background: #72bdb4;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: #72bdb4;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .stat-card h3 {
            color: #72bdb4;
            font-size: 1rem;
            margin-bottom: 10px;
        }
        
        .stat-card .stat-value {
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .stat-card .stat-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        .section-card {
            background: rgba(114, 189, 180, 0.2);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #72bdb4;
        }
        
        .section-card h2 {
            color: #ff9800;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .commande-card {
            background: #72bdb4;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            color: white;
        }
        
        .commande-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #72bdb4;
        }
        
        .commande-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
        }
        
        .detail-label {
            color: #72bdb4;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }
        
        .panier-items-admin {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .panier-item-admin {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .badge-attente {
            background: #72bdb4;
            color: white;
        }
        
        .badge-paye {
            background: #72bdb4;
            color: white;
        }
        
        .badge-livraison {
            background: #2196F3;
            color: white;
        }
        
        .badge-sur-place {
            background: #9C27B0;
            color: white;
        }
        
        .ventes-list {
            background: #72bdb4;
            padding: 20px;
            border-radius: 10px;
        }
        
        .vente-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            color: white;
        }
        
        .vente-nom {
            font-weight: bold;
        }
        
        .vente-quantite {
            color: #72bdb4;
            font-weight: bold;
        }
        
        .btn-suppr-commande {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: opacity 0.3s;
        }
        
        .btn-suppr-commande:hover {
            opacity: 0.8;
        }
        
        .btn-export-pdf:hover {
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div class="background"></div>
    
    <header>
        <a href="{{ url_for('accueil') }}" class="logo">
            <span class="logo">Chez Mich-Mich</span>
        </a>
        <button id="burger" class="burger">â˜°</button>
        <div id="sidebar" class="sidebar">
            <a href="{{ url_for('accueil') }}">ğŸ  Accueil</a>
            <a href="{{ url_for('admin_dashboard') }}">ğŸ“Š Dashboard</a>
            <a href="{{ url_for('admin_produits') }}">ğŸ± Produits</a>
            <a href="{{ url_for('admin_logout') }}">ğŸšª DÃ©connexion</a>
        </div>
    </header>

    <div class="admin-container">
        <div class="admin-header">
            <div>
                <h1 style="color: white; margin: 0;">Dashboard Administrateur</h1>
                <p style="color: #72bdb4; margin: 5px 0 0 0;">Bienvenue sur votre espace de gestion</p>
            </div>
            <div class="admin-nav">
                <a href="{{ url_for('admin_dashboard') }}">ğŸ“Š Dashboard</a>
                <a href="{{ url_for('admin_produits') }}">ğŸ± Produits</a>
                <a href="{{ url_for('admin_logout') }}">ğŸšª DÃ©connexion</a>
            </div>
        </div>

        <!-- Statistiques principales -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“¦</div>
                <h3>Total Commandes</h3>
                <div class="stat-value">{{ total_commandes }}</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ’°</div>
                <h3>Chiffre d'Affaires Total</h3>
                <div class="stat-value">{{ chiffre_affaire|round(2) }}â‚¬</div>
            </div>
            
            <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="stat-icon">ğŸ“…</div>
                <h3>Commandes {{ mois_actuel }}</h3>
                <div class="stat-value">{{ total_commandes_mois }}</div>
            </div>
            
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="stat-icon">ğŸ’µ</div>
                <h3>CA {{ mois_actuel }}</h3>
                <div class="stat-value">{{ chiffre_affaire_mois|round(2) }}â‚¬</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ›’</div>
                <h3>Paniers AbandonnÃ©s</h3>
                <div class="stat-value">{{ paniers_abandonnes }}</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">ğŸ‘¥</div>
                <h3>Visites du Site</h3>
                <div class="stat-value">{{ visites }}</div>
            </div>
        </div>
        
        <!-- Bouton Export PDF -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
            <a href="{{ url_for('admin_export_pdf') }}" class="btn-export-pdf" style="background: #e74c3c; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: bold; display: inline-block;">
                ğŸ“„ Exporter les ventes du mois en PDF
            </a>
            <form action="{{ url_for('admin_supprimer_commandes_terminees') }}" method="post" style="display: inline;" onsubmit="return confirm('âš ï¸ Supprimer TOUTES les commandes terminÃ©es ? Cette action est irrÃ©versible!');">
                <button type="submit" class="btn-suppr-masse" style="background: #c0392b; color: white; padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold;">
                    ğŸ—‘ï¸ Nettoyer les commandes terminÃ©es
                </button>
            </form>
        </div>

        <!-- Meilleures ventes -->
        <div class="section-card">
            <h2>ğŸ† Meilleures Ventes</h2>
            <div class="ventes-list">
                {% if meilleures_ventes %}
                    {% for produit, quantite in meilleures_ventes %}
                    <div class="vente-item">
                        <span class="vente-nom">{{ produit }}</span>
                        <span class="vente-quantite">{{ quantite }} vendus</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: white; text-align: center;">Aucune vente pour le moment</p>
                {% endif %}
            </div>
        </div>

        <!-- Liste des commandes -->
        <div class="section-card">
            <h2>ğŸ“‹ DerniÃ¨res Commandes</h2>
            
            {% if commandes %}
                {% for commande in commandes|reverse %}
                <div class="commande-card">
                    <div class="commande-header">
                        <div>
                            <h3 style="margin: 0; color: white;">Commande #{{ commande.id }}</h3>
                            <small style="color: #72bdb4;">{{ commande.date_commande }}</small>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <span class="badge {% if commande.statut_paiement == 'PayÃ©' %}badge-paye{% else %}badge-attente{% endif %}">
                                {{ commande.statut_paiement }}
                            </span>
                            <span class="badge {% if commande.type_retrait == 'livraison' %}badge-livraison{% else %}badge-sur-place{% endif %}">
                                {{ 'ğŸš— Livraison' if commande.type_retrait == 'livraison' else 'ğŸª Sur place' }}
                            </span>
                            <form action="{{ url_for('admin_supprimer_commande', commande_id=commande.id) }}" method="post" style="display: inline;" onsubmit="return confirm('Supprimer cette commande terminÃ©e ?');">
                                <button type="submit" class="btn-suppr-commande">ğŸ—‘ï¸</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="commande-details">
                        <div class="detail-item">
                            <div class="detail-label">ğŸ‘¤ Client</div>
                            <div style="color: white;">{{ commande.nom }}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">ğŸ“§ Email</div>
                            <div style="color: white;">{{ commande.email }}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">ğŸ“ TÃ©lÃ©phone</div>
                            <div style="color: white;">{{ commande.telephone }}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">ğŸ“ Lieu</div>
                            <div style="color: white;">
                                {% if commande.type_retrait == 'livraison' %}
                                    {{ commande.adresse }}
                                {% else %}
                                    {{ commande.ville }}
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">ğŸ“… Date/Heure</div>
                            <div style="color: white;">{{ commande.date_retrait }}<br>{{ commande.creneau }}</div>
                        </div>
                        
                        <div class="detail-item">
                            <div class="detail-label">ğŸ’³ Paiement</div>
                            <div style="color: white;">{{ commande.mode_paiement }}</div>
                        </div>
                    </div>
                    
                    <div class="panier-items-admin">
                        <div class="detail-label" style="margin-bottom: 10px;">ğŸ›’ Produits commandÃ©s</div>
                        {% for item in commande.panier %}
                        <div class="panier-item-admin">
                            <span>{{ item.nom }} ({{ item.type }})</span>
                            <span>x{{ item.quantite }} - {{ (item.prix * item.quantite)|round(2) }}â‚¬</span>
                        </div>
                        {% endfor %}
                        <div style="text-align: right; margin-top: 10px; padding-top: 10px; border-top: 2px solid #72bdb4;">
                            <strong style="color: #72bdb4; font-size: 1.2rem;">Total: {{ commande.total|round(2) }}â‚¬</strong>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: white; text-align: center; padding: 40px;">Aucune commande pour le moment</p>
            {% endif %}
        </div>
    </div>

    <footer>
        <p>Â© 2025 Chez Mich-Mich â€“ Tous droits rÃ©servÃ©s</p>
    </footer>

    <script src="{{ url_for('static', filename='michmich.js') }}"></script>
</body>
</html>